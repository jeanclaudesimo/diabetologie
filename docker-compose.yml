services:
  # Coming Soon Page (öffentlich zugänglich)
  diabetologie-coming-soon:
    build:
      context: ./coming-soon
      dockerfile: Dockerfile
    container_name: diabetologie-coming-soon
    restart: unless-stopped
    networks:
      - traefik-net
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=traefik-net"
      - "traefik.http.services.diabetologie-coming-soon.loadbalancer.server.port=80"

      # HTTPS Router für Hauptdomain (öffentlich)
      - "traefik.http.routers.diabetologie-coming-soon.entrypoints=frontendsecure"
      - "traefik.http.routers.diabetologie-coming-soon.rule=Host(`diabetologie-derschlag.de`)"
      - "traefik.http.routers.diabetologie-coming-soon.tls=true"
      - "traefik.http.routers.diabetologie-coming-soon.tls.certresolver=leresolver"
      - "traefik.http.routers.diabetologie-coming-soon.priority=1"

  # Hauptseite (mit Basic Auth geschützt)
  diabetologie:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: diabetologie
    ports:
      - "3007:3007"
    environment:
      - NODE_ENV=production
      - NEXT_TELEMETRY_DISABLED=1
      - GOOGLE_PLACES_API_KEY=${GOOGLE_PLACES_API_KEY}
      - NEXT_PUBLIC_GOOGLE_MAPS_API_KEY=${NEXT_PUBLIC_GOOGLE_MAPS_API_KEY}
      - NEXT_PUBLIC_GOOGLE_PLACE_ID=${NEXT_PUBLIC_GOOGLE_PLACE_ID}
    restart: unless-stopped
    networks:
      - traefik-net
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=traefik-net"
      - "traefik.http.services.diabetologie.loadbalancer.server.port=3005"

      # Basic Auth Middleware (Beispiel: admin/preview123)
      # Um ein neues Passwort zu generieren: docker run --rm httpd:alpine htpasswd -nbB username password
      - "traefik.http.middlewares.diabetologie-auth.basicauth.users=admin:$$2a$$12$$s1EkgNAxDleSe.sOMx52LuyPbsPzbeM2XdzaGnIj0HxetRSHXQalS"

      # HTTPS Router für Preview-Subdomain (mit Basic Auth)
      - "traefik.http.routers.diabetologie.entrypoints=frontendsecure"
      - "traefik.http.routers.diabetologie.rule=Host(`preview.digitalssolutions.de`)"
      - "traefik.http.routers.diabetologie.tls=true"
      - "traefik.http.routers.diabetologie.tls.certresolver=leresolver"
      - "traefik.http.routers.diabetologie.middlewares=diabetologie-auth"
      - "traefik.http.routers.diabetologie.service=diabetologie"
      - "traefik.http.routers.diabetologie.priority=10"

networks:
  traefik-net:
    external: true
